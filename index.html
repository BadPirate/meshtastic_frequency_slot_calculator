<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meshtastic Frequency Slot Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
        }
        .result-card {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            min-height: 200px;
        }
        .frequency-display {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        .region-info {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .form-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .github-corner {
            position: fixed;
            top: 0;
            right: 0;
            z-index: 1000;
        }
        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out;
        }
        @keyframes octocat-wave {
            0%, 100% { transform: rotate(0) }
            20%, 60% { transform: rotate(-25deg) }
            40%, 80% { transform: rotate(10deg) }
        }
    </style>
</head>
<body>
    <!-- GitHub Corner -->
    <a href="https://github.com/BadPirate/meshtastic_frequency_slot_calculator" class="github-corner" aria-label="View source on GitHub" title="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
    </a>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h1 class="display-4 mb-4">
                        <i class="fas fa-radio me-3"></i>
                        Meshtastic Frequency Slot Calculator
                    </h1>
                    <p class="lead mb-4">
                        Calculate frequency slots for Meshtastic channel names across different LoRa regions worldwide.
                        Perfect for setting up private channels and understanding frequency allocation.
                    </p>
                    <div class="row text-center mt-4">
                        <div class="col-md-4">
                            <i class="fas fa-globe fa-2x mb-2"></i>
                            <h5>18 Regions</h5>
                            <p class="small">Worldwide coverage</p>
                        </div>
                        <div class="col-md-4">
                            <i class="fas fa-bolt fa-2x mb-2"></i>
                            <h5>Live Updates</h5>
                            <p class="small">Real-time calculations</p>
                        </div>
                        <div class="col-md-4">
                            <i class="fas fa-code fa-2x mb-2"></i>
                            <h5>Open Source</h5>
                            <p class="small">GPL-3.0 Licensed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <!-- Input Form -->
            <div class="col-lg-6 mb-4">
                <div class="form-section p-4">
                    <h3 class="mb-4">
                        <i class="fas fa-sliders-h me-2"></i>
                        Configuration
                    </h3>
                    
                    <form id="calculatorForm">
                        <!-- Region Selection -->
                        <div class="mb-3">
                            <label for="regionSelect" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                LoRa Region
                            </label>
                            <select class="form-select" id="regionSelect" required>
                                <option value="US" selected>US - North America - 915 MHz ISM Band</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                            <div class="form-text">Select your geographical region for proper frequency allocation.</div>
                        </div>

                        <!-- Channel Name -->
                        <div class="mb-3">
                            <label for="channelName" class="form-label">
                                <i class="fas fa-tag me-1"></i>
                                Channel Name
                            </label>
                            <input type="text" class="form-control" id="channelName" value="LongFast" required>
                            <div class="form-text">Enter the channel name (case-sensitive).</div>
                        </div>

                        <!-- Bandwidth -->
                        <div class="mb-3">
                            <label for="bandwidthSelect" class="form-label">
                                <i class="fas fa-signal me-1"></i>
                                Bandwidth
                            </label>
                            <select class="form-select" id="bandwidthSelect">
                                <option value="auto" selected>Auto (based on channel name)</option>
                                <option value="125">125 kHz</option>
                                <option value="250">250 kHz</option>
                                <option value="500">500 kHz</option>
                            </select>
                            <div class="form-text">Bandwidth determines signal width and data rate.</div>
                        </div>

                        <!-- Preset Examples -->
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="fas fa-list me-1"></i>
                                Common Presets
                            </label>
                            <div class="d-flex flex-wrap gap-2">
                                <button type="button" class="btn btn-outline-primary btn-sm preset-btn" data-channel="LongFast">LongFast</button>
                                <button type="button" class="btn btn-outline-primary btn-sm preset-btn" data-channel="MediumSlow">MediumSlow</button>
                                <button type="button" class="btn btn-outline-primary btn-sm preset-btn" data-channel="ShortTurbo">ShortTurbo</button>
                                <button type="button" class="btn btn-outline-primary btn-sm preset-btn" data-channel="LongMod">LongMod</button>
                                <button type="button" class="btn btn-outline-primary btn-sm preset-btn" data-channel="LongSlow">LongSlow</button>
                            </div>
                            <div class="form-text">Click to quickly set common channel names.</div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results -->
            <div class="col-lg-6">
                <div class="result-card p-4 h-100">
                    <h3 class="mb-4">
                        <i class="fas fa-calculator me-2"></i>
                        Results
                    </h3>
                    
                    <div id="calculationResults">
                        <div class="text-center text-muted">
                            <i class="fas fa-cog fa-spin fa-3x mb-3"></i>
                            <p>Calculating...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Information Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">
                            <i class="fas fa-info-circle me-2"></i>
                            About This Tool
                        </h4>
                        <p class="card-text">
                            This calculator implements the same frequency slot algorithm used by the Meshtastic firmware. 
                            It uses the djb2 hash function on the channel name to determine which frequency slot to use 
                            within the available spectrum for each region.
                        </p>
                        <p class="card-text">
                            <strong>Important:</strong> For nodes to communicate, they must use the exact same channel name, 
                            modem preset, and be in the same frequency slot. This tool helps you determine the frequency 
                            slot for any given channel name.
                        </p>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <h6><i class="fas fa-link me-1"></i> Useful Links</h6>
                                <ul class="list-unstyled">
                                    <li><a href="https://meshtastic.org/" target="_blank" class="text-decoration-none">
                                        <i class="fas fa-external-link-alt me-1"></i> Meshtastic Project
                                    </a></li>
                                    <li><a href="https://meshtastic.org/docs/configuration/region-by-country/" target="_blank" class="text-decoration-none">
                                        <i class="fas fa-external-link-alt me-1"></i> Region Documentation
                                    </a></li>
                                    <li><a href="https://github.com/heypete/meshtastic_frequency_slot_calculator" target="_blank" class="text-decoration-none">
                                        <i class="fas fa-external-link-alt me-1"></i> Original Python Version
                                    </a></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-code me-1"></i> Technical Details</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check me-1 text-success"></i> Based on Meshtastic firmware</li>
                                    <li><i class="fas fa-check me-1 text-success"></i> djb2 hash algorithm</li>
                                    <li><i class="fas fa-check me-1 text-success"></i> 18 supported regions</li>
                                    <li><i class="fas fa-check me-1 text-success"></i> Real-time calculations</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">
                        <i class="fas fa-code me-1"></i>
                        Fork of <a href="https://github.com/heypete/meshtastic_frequency_slot_calculator" class="text-light">heypete's calculator</a>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        <i class="fas fa-balance-scale me-1"></i>
                        Licensed under GPL-3.0
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="frequency_calculator.js"></script>
    <script>
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateRegionSelect();
            setupEventListeners();
            updateCalculation(); // Initial calculation
        });

        // Populate region dropdown
        function populateRegionSelect() {
            const regionSelect = document.getElementById('regionSelect');
            regionSelect.innerHTML = ''; // Clear existing options
            
            Object.keys(window.MeshtasticFrequencyCalculator.REGION_FREQUENCIES).forEach(regionCode => {
                const region = window.MeshtasticFrequencyCalculator.REGION_FREQUENCIES[regionCode];
                const option = document.createElement('option');
                option.value = regionCode;
                option.textContent = `${regionCode} - ${region.description}`;
                if (regionCode === 'US') {
                    option.selected = true;
                }
                regionSelect.appendChild(option);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Form inputs
            document.getElementById('regionSelect').addEventListener('change', updateCalculation);
            document.getElementById('channelName').addEventListener('input', updateCalculation);
            document.getElementById('bandwidthSelect').addEventListener('change', updateCalculation);
            
            // Preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('channelName').value = this.dataset.channel;
                    updateCalculation();
                    
                    // Visual feedback
                    this.classList.add('btn-primary');
                    this.classList.remove('btn-outline-primary');
                    setTimeout(() => {
                        this.classList.remove('btn-primary');
                        this.classList.add('btn-outline-primary');
                    }, 200);
                });
            });
        }

        // Update calculation and display results
        function updateCalculation() {
            const region = document.getElementById('regionSelect').value;
            const channelName = document.getElementById('channelName').value.trim();
            const bandwidthSelect = document.getElementById('bandwidthSelect').value;
            
            if (!channelName) {
                document.getElementById('calculationResults').innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <p>Please enter a channel name</p>
                    </div>
                `;
                return;
            }
            
            // Determine bandwidth
            let customBandwidth = null;
            if (bandwidthSelect !== 'auto') {
                customBandwidth = parseInt(bandwidthSelect);
            }
            
            // Calculate
            const result = window.MeshtasticFrequencyCalculator.calculateFrequencySlot(
                region, 
                channelName, 
                customBandwidth
            );
            
            if (result.error) {
                document.getElementById('calculationResults').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <strong>Error:</strong> ${result.error}
                    </div>
                `;
                return;
            }
            
            // Display results
            document.getElementById('calculationResults').innerHTML = `
                <div class="region-info">
                    <h5 class="mb-2">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        ${result.region}
                    </h5>
                    <p class="mb-1"><strong>Description:</strong> ${result.regionDescription}</p>
                    <p class="mb-0"><strong>Frequency Range:</strong> ${result.frequencyRange}</p>
                </div>
                
                <div class="row g-3">
                    <div class="col-sm-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-hashtag text-primary mb-2" style="font-size: 1.5rem;"></i>
                                <h6 class="card-title">Channel Name</h6>
                                <p class="card-text"><code>${result.channelName}</code></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-list-ol text-primary mb-2" style="font-size: 1.5rem;"></i>
                                <h6 class="card-title">Frequency Slot</h6>
                                <p class="card-text"><strong>${result.frequencySlot}</strong> of ${result.numFreqSlots}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-broadcast-tower text-primary mb-2" style="font-size: 1.5rem;"></i>
                                <h6 class="card-title">Frequency</h6>
                                <p class="card-text frequency-display">${result.selectedFrequency.toFixed(3)} MHz</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-signal text-primary mb-2" style="font-size: 1.5rem;"></i>
                                <h6 class="card-title">Bandwidth</h6>
                                <p class="card-text"><strong>${result.bandwidth}</strong> kHz</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3 p-3 bg-light rounded">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        <strong>Note:</strong> This frequency slot calculation matches the Meshtastic firmware implementation. 
                        Nodes must use identical channel names and modem settings to communicate.
                    </small>
                </div>
            `;
        }
    </script>
</body>
</html>
